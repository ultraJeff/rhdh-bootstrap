# Azure DevOps Integration Secrets for RHDH
#
# To use:
# 1. Copy this file to ado-secrets.yaml (it's gitignored)
# 2. Fill in your Azure DevOps / Entra ID credentials
# 3. Apply with: oc apply -f ado-secrets.yaml
#
# Prerequisites:
# - Azure DevOps organization with repos you want to discover
# - Personal Access Token (PAT):
#   - For catalog/file reading: Code (Read), Build (Read)
#   - For software template "Publish to Azure DevOps": Code (Read & write) or Code (Full)
#     (Read-only Code scope causes 401 on publish)
# - (Optional) Azure Entra ID app registration for OAuth
#
# For setup instructions, see:
# https://docs.redhat.com/en/documentation/red_hat_developer_hub/1.8/html/dynamic_plugins_reference/con-preinstalled-dynamic-plugins
#
apiVersion: v1
kind: Secret
metadata:
  name: ado-secrets
  namespace: rhdh
  annotations:
    argocd.argoproj.io/sync-wave: "2"
type: Opaque
stringData:
  # Azure DevOps Organization name (for backend plugin)
  # This is the organization name from your Azure DevOps URL:
  # https://dev.azure.com/<AZURE_ORG>
  AZURE_ORG: <your-azure-devops-org>
  
# Azure DevOps Personal Access Token (for backend plugin, file reading, and publish:azure)
# Create at: https://dev.azure.com/<your-org>/_usersSettings/tokens
# Required scopes:
#   - Code (Read & write) or Code (Full) - for publish:azure
#   - Build (Read & Execute) - for pipeline creation
#   - Project and team (Read)
  AZURE_TOKEN: <your-personal-access-token>

  # Base64-encoded token for Azure DevOps API proxy (used by http:backstage:request)
  # Generate with: echo -n ":YOUR_PAT_TOKEN" | base64
  # Note: The colon prefix is required for Azure DevOps Basic auth
  AZURE_TOKEN_BASE64: <base64-encoded-colon-pat>
  
  # Azure DevOps catalog location URL (for catalog integration)
  # Full URL to your catalog-info.yaml in Azure DevOps
  # Format: https://dev.azure.com/<org>/<project>/_git/<repo>?path=/catalog-info.yaml&version=GBmain
  AZURE_DEVOPS_CATALOG_URL: <your-catalog-url>
  
  # Azure Entra ID (formerly Azure AD) App Registration credentials
  # These are optional if using PAT above, but needed for OAuth-based access
  # Create an app registration in Azure Portal > Entra ID > App registrations
  AZURE_CLIENT_ID: <your-client-id>              # Application (client) ID
  AZURE_CLIENT_SECRET: <your-client-secret>      # Client secret value
  AZURE_TENANT_ID: <your-tenant-id>              # Directory (tenant) ID
